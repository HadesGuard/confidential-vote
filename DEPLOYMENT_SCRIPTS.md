# Deployment Scripts

This directory contains automated scripts for deploying the Confidential Voting contract and updating the frontend configuration.

## Scripts Overview

### 1. `deploy-and-update.sh` (Full Deployment Script)
**Complete automated deployment with error handling and verification**

**Features:**
- ✅ Compiles contract
- ✅ Deploys to Sepolia
- ✅ Creates backup of previous contract address
- ✅ Updates `.env` file
- ✅ Updates `contracts.ts` file
- ✅ Verifies frontend build
- ✅ Colored output with status messages
- ✅ Error handling and rollback capability

**Usage:**
```bash
chmod +x deploy-and-update.sh
./deploy-and-update.sh
```

### 2. `deploy.sh` (Quick Deployment Script)
**Fast deployment for development**

**Features:**
- ✅ Quick contract deployment
- ✅ Basic frontend updates
- ✅ Minimal output

**Usage:**
```bash
chmod +x deploy.sh
./deploy.sh
```

### 3. `rollback.sh` (Rollback Script)
**Revert to previous contract address**

**Features:**
- ✅ Restores previous contract address
- ✅ Updates both `.env` and `contracts.ts`
- ✅ Requires backup file from full deployment

**Usage:**
```bash
chmod +x rollback.sh
./rollback.sh
```

## Prerequisites

1. **Environment Setup:**
   ```bash
   # In fhevm-hardhat directory
   npm install
   
   # In voting-app directory
   npm install
   ```

2. **Environment Variables:**
   ```bash
   # Create .env file in fhevm-hardhat directory
   PRIVATE_KEY=your_private_key_here
   SEPOLIA_RPC_URL=your_sepolia_rpc_url_here
   ```

3. **Network Configuration:**
   - Ensure you're connected to Sepolia testnet
   - Have sufficient ETH for gas fees

## Deployment Process

### Step-by-Step (Manual)
```bash
# 1. Compile contract
cd fhevm-hardhat
npx hardhat compile

# 2. Deploy contract
npx hardhat run deploy/deploy-confidential-vote.ts --network sepolia

# 3. Copy contract address from output

# 4. Update frontend .env
cd ../voting-app
echo "NEXT_PUBLIC_CONTRACT_ADDRESS=0x..." >> .env

# 5. Update contracts.ts
# Manually update the address in lib/contracts.ts

# 6. Build frontend
npm run build
```

### Automated (Recommended)
```bash
# Full deployment with verification
./deploy-and-update.sh

# Or quick deployment
./deploy.sh
```

## File Structure After Deployment

```
confidential-vote/
├── fhevm-hardhat/
│   ├── artifacts/
│   ├── deploy/
│   └── ...
├── voting-app/
│   ├── .env                    # Updated with contract address
│   ├── lib/
│   │   └── contracts.ts        # Updated with contract address
│   └── ...
├── contract-address.backup     # Backup of previous address
├── deploy-and-update.sh        # Full deployment script
├── deploy.sh                   # Quick deployment script
└── rollback.sh                 # Rollback script
```

## Troubleshooting

### Common Issues

1. **Permission Denied:**
   ```bash
   chmod +x deploy-and-update.sh
   chmod +x deploy.sh
   chmod +x rollback.sh
   ```

2. **Contract Compilation Failed:**
   - Check Solidity syntax
   - Ensure all dependencies are installed
   - Verify hardhat configuration

3. **Deployment Failed:**
   - Check private key in `.env`
   - Verify Sepolia RPC URL
   - Ensure sufficient ETH balance

4. **Frontend Build Failed:**
   - Check TypeScript errors
   - Verify contract address format
   - Ensure all dependencies are installed

### Rollback Process

If deployment fails or you need to revert:

```bash
# Check if backup exists
ls contract-address.backup

# Rollback to previous address
./rollback.sh
```

## Environment Variables

### Required in `fhevm-hardhat/.env`:
```
PRIVATE_KEY=your_private_key_here
SEPOLIA_RPC_URL=your_sepolia_rpc_url_here
```

### Generated in `voting-app/.env`:
```
NEXT_PUBLIC_CONTRACT_ADDRESS=0x... # Auto-generated by script
```

## Security Notes

- ⚠️ **Never commit private keys to version control**
- ⚠️ **Use testnet private keys only**
- ⚠️ **Keep backup files secure**
- ✅ **Scripts create backups automatically**
- ✅ **Rollback capability for safe deployments**

## Support

If you encounter issues:

1. Check the script output for error messages
2. Verify all prerequisites are met
3. Ensure network connectivity
4. Check gas fees and ETH balance 